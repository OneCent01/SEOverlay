(()=>{"use strict";document.getElementById("mav_counter");const e="221785400",t="184426448",r=document.getElementById("game_board"),i=(r.getContext("2d"),()=>{r.height=window.innerHeight,r.width=window.innerWidth}),a=e=>e.clearRect(0,0,e.canvas.width,e.canvas.height),s=(e,t,r)=>e.map(((e,i)=>((e,t,r)=>Math.min(e,t)+Math.abs(e-t)*r)(e,t[i],r))),o=(e,t,r)=>{e.lineWidth=r.lineWidth;const[i,a]=[r.x-r.radius/2,r.y-r.radius/2];e.save(),e.translate(i,a),e.rotate(t.progress*r.rotationSpeed%360*(Math.PI/180)),e.beginPath(),e.moveTo(0,0-(2*r.lineWidth+r.radius/2)),e.lineTo(0,2*r.lineWidth+r.radius/2),e.stroke(),e.rotate(Math.PI/3),e.beginPath(),e.moveTo(0,0-(2*r.lineWidth+r.radius/2)),e.lineTo(0,2*r.lineWidth+r.radius/2),e.stroke(),e.rotate(Math.PI/3),e.beginPath(),e.moveTo(0,0-(2*r.lineWidth+r.radius/2)),e.lineTo(0,2*r.lineWidth+r.radius/2),e.stroke(),e.translate(0-i,0-a),e.beginPath(),e.arc(r.x-r.radius/2,r.y-r.radius/2,r.radius-r.lineWidth,0,2*Math.PI),e.stroke(),e.restore()},n=document.createElement("canvas"),l=n.getContext("2d"),c=document.createElement("canvas");c.height="160",c.width="170";const d=c.getContext("2d"),u=(e,t,r,i)=>{e.fillStyle=i||"#c79e75",t*=2,r*=2;const a=t+=60,s=r+=100,o=e;e.scale(.5,.5),o.beginPath(),o.moveTo(176+a,121+s),o.bezierCurveTo(169+a,144+s,166+a,217+s,162+a,220+s),o.bezierCurveTo(157+a,224+s,142+a,217+s,139+a,222+s),o.bezierCurveTo(136+a,228+s,128+a,229+s,139+a,240+s),o.bezierCurveTo(144+a,245+s,163+a,244+s,170+a,238+s),o.bezierCurveTo(178+a,231+s,185+a,213+s,189+a,201+s),o.bezierCurveTo(203+a,155+s,209+a,129+s,204+a,114+s),o.bezierCurveTo(201+a,105+s,186+a,109+s,179+a,113+s),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)},h=(e,t,r,i)=>{e.fillStyle=i||"#c79e75",t*=3,r*=3;const a=t+=320,s=r+=280,o=e;e.scale(1/3,1/3),o.beginPath(),o.moveTo(193+a,205+s),o.bezierCurveTo(189+a,208+s,116+a,204+s,110+a,208+s),o.bezierCurveTo(98+a,217+s,104+a,227+s,112+a,229+s),o.bezierCurveTo(121+a,231+s,235+a,230+s,242+a,223+s),o.bezierCurveTo(246+a,219+s,269+a,167+s,259+a,150+s),o.bezierCurveTo(251+a,136+s,244+a,131+s,232+a,128+s),o.bezierCurveTo(209+a,122+s,165+a,124+s,156+a,125+s),o.bezierCurveTo(148+a,126+s,122+a,150+s,130+a,172+s),o.bezierCurveTo(133+a,181+s,165+a,200+s,187+a,204+s),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)},T=(e,t,r)=>{a(d);const[i,o]=[-84,-10];u(d,i-5,o-5,"#ad763e"),h(d,i-5,o-5,"#ad763e"),((e,t,r)=>{e.fillStyle="#cc9258",t*=2,r*=2;const i=t+=50,a=r+=30,s=e;e.scale(.5,.5),s.beginPath(),s.beginPath(),s.moveTo(178+i,145+a),s.bezierCurveTo(180+i,164+a,180+i,191+a,192+i,220+a),s.bezierCurveTo(204+i,248+a,250+i,275+a,269+i,285+a),s.bezierCurveTo(302+i,302+a,307+i,292+a,316+i,288+a),s.bezierCurveTo(326+i,284+a,339+i,261+a,333+i,248+a),s.bezierCurveTo(311+i,199+a,257+i,176+a,250+i,169+a),s.bezierCurveTo(239+i,158+a,230+i,141+a,224+i,131+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(d,i,o),((e,t,r)=>{e.fillStyle="#cc9258",t*=2,r*=2;const i=t-=0,a=r-=0,s=e;e.scale(.5,.5),s.beginPath(),s.moveTo(168+i,163+a),s.bezierCurveTo(168+i,171+a,171+i,175+a,174+i,179+a),s.bezierCurveTo(181+i,188+a,227+i,180+a,242+i,177+a),s.bezierCurveTo(259+i,174+a,275+i,171+a,277+i,167+a),s.bezierCurveTo(281+i,159+a,276+i,117+a,266+i,110+a),s.bezierCurveTo(254+i,101+a,228+i,104+a,219+i,116+a),s.bezierCurveTo(209+i,129+a,216+i,132+a,209+i,138+a),s.bezierCurveTo(203+i,143+a,178+i,148+a,170+i,155+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(d,i,o),((e,t,r)=>{e.fillStyle="#c79e75",t*=3,r*=3;const i=t+=230,a=r+=60,s=e;e.scale(1/3,1/3),s.beginPath(),s.moveTo(140+i,95+a),s.bezierCurveTo(150+i,92+a,203+i,79+a,204+i,99+a),s.bezierCurveTo(205+i,119+a,172+i,159+a,163+i,161+a),s.bezierCurveTo(155+i,163+a,129+i,110+a,131+i,99+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(d,i,o),u(d,i,o),h(d,i,o),((e,t,r,i,a,o)=>{e.fillStyle=a||"#c79e75",t*=2,r*=2;const n=t+=280,l=r+=80,c=e;e.scale(.5,.5),c.beginPath(),c.moveTo(94+n,225+l);const d=(i<=50?2*i:200-2*i)/100;let u,h,T,v;switch(o){case"straight":u=[175+n,221+l,209+n,209+l,214+n,220+l],h=[175+n,221+l,186+n,172+l,195+n,181+l],T=[218+n,229+l,177+n,238+l,96+n,242+l],v=[200+n,186+l,177+n,238+l,96+n,242+l];break;case"erect":u=[175+n,221+l,162+n,125+l,175+n,134+l],h=[175+n,221+l,132+n,134+l,146+n,141+l],T=[186+n,142+l,177+n,238+l,96+n,242+l],v=[161+n,148+l,177+n,238+l,96+n,242+l];break;default:console.log(`[WARNING] Unsupported type: ${o}`)}const b=s(u,h,d);c.bezierCurveTo(...b);const m=s(T,v,d);c.bezierCurveTo(...m),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(d,i,o,(r.tailStartPosition+t.progress*r.wagSpeed)%100,r.color,r.tailType,r.tailStartPosition);const n=c.width*(r.scale||1),l=c.height*(r.scale||1),T=r.x+n/2,v=r.y+l/2;e.translate(T,v),e.rotate(r.skew*(Math.PI/180)),e.drawImage(c,-n/2,-l/2,n,l),e.rotate(-r.skew*(Math.PI/180)),e.translate(-T,-v)},v=Math.round(100*Math.random()),b=document.getElementById("game_board").getContext("2d"),m=(e,t)=>{a(b),((e,t,r)=>{((e,t,r)=>{a(l);const i={x:32,y:65};((e,t,r)=>{o(e,t,{x:r.x,y:r.y,lineWidth:4,radius:22,rotationSpeed:-3}),o(e,t,{x:r.x+36+66,y:r.y,lineWidth:4,radius:22,rotationSpeed:-3})})(l,t,i),((e,t,r)=>{((e,t,r)=>{e.fillStyle="#B53A3A",t*=5,r*=5,t-=124,r-=480,e.scale(.2,.2),e.beginPath(),e.moveTo(157+t,282+r),e.bezierCurveTo(169+t,292+r,308+t,279+r,321+t,273+r),e.bezierCurveTo(340+t,264+r,314+t,238+r,300+t,232+r),e.bezierCurveTo(287+t,226+r,198+t,199+r,163+t,219+r),e.bezierCurveTo(150+t,226+r,141+t,267+r,154+t,280+r),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="black",t*=3,r*=3,t+=60,r-=200,e.scale(1/3,1/3),e.beginPath(),e.moveTo(45+t,73+r),e.bezierCurveTo(39+t,81+r,38+t,84+r,45+t,93+r),e.bezierCurveTo(53+t,103+r,128+t,93+r,143+t,90+r),e.bezierCurveTo(156+t,87+r,157+t,87+r,171+t,73+r),e.bezierCurveTo(176+t,68+r,224+t,61+r,231+t,74+r),e.bezierCurveTo(238+t,87+r,251+t,71+r,239+t,62+r),e.bezierCurveTo(217+t,46+r,175+t,50+r,162+t,64+r),e.bezierCurveTo(155+t,71+r,62+t,68+r,46+t,73+r),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="#555555",t*=2,r*=2,t-=20,r-=130,e.scale(.5,.5),e.beginPath(),e.moveTo(37+t,54+r);const i=t,a=r;e.bezierCurveTo(37+i,69+a,43+i,126+a,49+i,130+a),e.bezierCurveTo(57+i,135+a,143+i,129+a,145+i,125+a),e.bezierCurveTo(158+i,100+a,179+i,64+a,174+i,60+a),e.bezierCurveTo(171+i,58+a,89+i,57+a,88+i,64+a),e.bezierCurveTo(87+i,72+a,99+i,79+a,97+i,81+a),e.bezierCurveTo(93+i,85+a,58+i,85+a,51+i,83+a),e.bezierCurveTo(46+i,81+a,47+i,66+a,43+i,47+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="black",t*=4,r*=4;const i=t+=228,a=r-=235,s=e;e.scale(1/4,1/4),e.beginPath(),s.moveTo(70+i,66+a),s.bezierCurveTo(72+i,76+a,118+i,179+a,124+i,188+a),s.bezierCurveTo(127+i,193+a,135+i,187+a,135+i,183+a),s.bezierCurveTo(134+i,173+a,87+i,65+a,82+i,53+a),s.bezierCurveTo(80+i,48+a,66+i,62+a,70+i,64+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{t*=3,r*=3;const i=t-=185,a=r-=290,s=e;e.scale(1/3,1/3),s.beginPath(),s.moveTo(146+i,256+a),s.bezierCurveTo(147+i,261+a,151+i,264+a,154+i,263+a),s.bezierCurveTo(159+i,261+a,204+i,140+a,212+i,124+a),s.bezierCurveTo(214+i,120+a,200+i,112+a,199+i,115+a),s.bezierCurveTo(191+i,131+a,156+i,230+a,150+i,247+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="black",t*=3,r*=3;const i=t-=110,a=r-=270,s=e;e.scale(1/3,1/3),s.beginPath(),s.moveTo(118+i,101+a),s.bezierCurveTo(137+i,104+a,183+i,108+a,198+i,108+a),s.bezierCurveTo(206+i,108+a,206+i,105+a,200+i,98+a),s.bezierCurveTo(195+i,92+a,161+i,98+a,163+i,88+a),s.bezierCurveTo(165+i,76+a,154+i,80+a,129+i,77+a),s.bezierCurveTo(123+i,76+a,117+i,81+a,115+i,94+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="#555555",t*=4,r*=4;const i=t-=200,a=r-=380,s=e;e.scale(1/4,1/4),s.beginPath(),s.moveTo(214+i,163+a),s.bezierCurveTo(212+i,154+a,189+i,115+a,184+i,127+a),s.bezierCurveTo(181+i,133+a,173+i,191+a,179+i,200+a),s.bezierCurveTo(186+i,210+a,208+i,185+a,213+i,178+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="#999999",t*=2,r*=2;const i=t-=150,a=r-=185,s=e;e.scale(.5,.5),s.beginPath(),s.moveTo(222+i,127+a),s.bezierCurveTo(207+i,127+a,175+i,128+a,174+i,130+a),s.bezierCurveTo(172+i,133+a,176+i,173+a,183+i,180+a),s.bezierCurveTo(187+i,184+a,278+i,175+a,282+i,174+a),s.bezierCurveTo(291+i,172+a,342+i,141+a,344+i,142+a),s.bezierCurveTo(350+i,145+a,356+i,161+a,353+i,163+a),s.bezierCurveTo(349+i,165+a,295+i,182+a,287+i,184+a),s.bezierCurveTo(283+i,185+a,187+i,191+a,180+i,189+a),s.bezierCurveTo(177+i,188+a,164+i,127+a,167+i,124+a),s.bezierCurveTo(171+i,120+a,203+i,119+a,222+i,120+a),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y),((e,t,r)=>{e.fillStyle="#777777",t*=2,r*=2,t-=0,r-=115,e.scale(.5,.5),e.beginPath(),e.moveTo(35+t,34+r),e.bezierCurveTo(34+t,40+r,34+t,61+r,35+t,66+r),e.bezierCurveTo(36+t,73+r,58+t,72+r,59+t,66+r),e.bezierCurveTo(60+t,57+r,61+t,41+r,57+t,37+r),e.bezierCurveTo(53+t,33+r,39+t,35+r,35+t,36+r),e.closePath(),e.fill(),e.setTransform(1,0,0,1,0,0)})(e,r.x,r.y)})(l,0,i),e.drawImage(l.canvas,r.x,r.y,n.width*(r.scale||1),n.height*(r.scale||1))})(e,t,{x:r.x,y:r.y+window.innerHeight-73,scale:1}),T(e,t,{x:r.x+60,y:r.y+window.innerHeight-132,scale:.5,skew:-5,tailType:"straight",wagSpeed:1,tailStartPosition:v})})(b,t,{x:window.innerWidth-t.progress,y:-2}),Object.entries(e.hypeTrain.users).forEach((([e,r],i)=>{((e,t,r)=>{r={...r,x:r.x+5,y:r.y+25},T(e,t,{x:r.x+2,y:r.y-40,tailStartPosition:r.tailStartPosition,scale:.5,tailType:"erect",wagSpeed:1}),((e,t,r)=>{((e,t,r)=>{const{x:i,y:a,text:s,color:o}=r;e.fillStyle=o,e.beginPath(),e.moveTo(i,a);const n=50*Math.tan(Math.PI/180*4);e.lineTo(i+n,a+50),e.lineTo(i+80+n,a+50),e.lineTo(i+80+n+n,a),e.closePath(),e.fill(),e.fillStyle=r.textColor||"white",s.forEach(((t,r)=>{const s=80-e.measureText(t).width-5;e.fillText(t,i+n+n+s/2,a+25+12*r)}))})(e,0,{...r,y:r.y+20});const i={x:r.x+20,y:r.y+82,lineWidth:2,radius:12,rotationSpeed:-5};o(e,t,i),o(e,t,{...i,x:i.x+58})})(e,t,r)})(b,t,{...r,x:window.innerWidth-t.progress+148+100*i,y:window.innerHeight-113})}))},C=(e,t={continue:!0,progress:0})=>{t.progress+=1,m(e,t);const r=Object.keys(e.hypeTrain.users).length+1;window.innerWidth-t.progress+148+100*r<=0?(a(b),e.hypeTrain.isRunning=!1,t.progress=0):window.requestAnimationFrame((()=>C(e,t)))},g=document.getElementById("game_board").getContext("2d"),y=e=>parseInt(e,16),z=(e,t)=>{const r=[e.display_name];let i,a,s,o=0,n=!1;for(;!n;){const{width:e}=g.measureText(r[o]);if(e<74)r[o+1]?o++:n=!0;else{const e=r[o][r[o].length-1];r[o+1]=e+(r[o+1]||""),r[o]=r[o].slice(0,r[o].length-1)}}if(e.color){const t=e.color.slice(1);i=y(t.slice(0,2)),a=y(t.slice(2,4)),s=y(t.slice(4,6))}else{const e=(()=>{const e=Math.random(),t=Math.random();return Math.random(),((e,t,r)=>{var i,a,s,o,n,l,c,d;switch(!e||t||r||(t=e.s,r=e.v,e=e.h),l=r*(1-t),c=r*(1-(n=6*e-(o=Math.floor(6*e)))*t),d=r*(1-(1-n)*t),o%6){case 0:i=r,a=d,s=l;break;case 1:i=c,a=r,s=l;break;case 2:i=l,a=r,s=d;break;case 3:i=l,a=c,s=r;break;case 4:i=d,a=l,s=r;break;case 5:i=r,a=l,s=c}return{r:Math.round(255*i),g:Math.round(255*a),b:Math.round(255*s)}})(360*e,(50+50*t)/100,(40+40*t)/100)})();i=e.r,a=e.g,s=e.b}const l=i+s+a>124?"dimgrey":"white",c=Math.round(100*Math.random()),d=`rgb(${i}, ${a}, ${s})`;t.hypeTrain.users[e.id]={hypes:[],color:d,text:r,textColor:l,tailStartPosition:c}},f=()=>new Headers({Authorization:"Bearer r0ntkepo27kiwtwqwinbq7wanb52ed","Client-Id":"29gkmfk098vqw909sl73keg3r38bl2"}),w=async e=>{const{data:t}=await(async e=>{const t=`https://api.twitch.tv/helix/chat/color?${e.map((e=>`user_id=${e}`))}`;return(await fetch(t,{headers:f()})).json()})(e),r=`https://api.twitch.tv/helix/users?${e.map((e=>`id=${e}`))}`,i=await fetch(r,{headers:f()});return(await i.json()).data.map((e=>{const r=t.find((t=>t.user_id===e.id));return{...e,...r}}))},p=e=>new Date(e).getTime(),x=async t=>{const{data:r}=await(async()=>{const t=`https://api.twitch.tv/helix/hypetrain/events?broadcaster_id=${e}&first=10`;return(await fetch(t,{headers:f()})).json()})();let i=r.length,a=!1;for(;i--;){const e=r[i],s=p(e.event_data.expires_at)<Date.now(),o=!t.hypeTrain.events[e.id];if(!s&&o){const{started_at:r,level:i,total:s,goal:o}=e.event_data;t.hypeTrain.startedAt!==r&&p(r)>p(t.hypeTrain.startedAt)&&(t.hypeTrain={startedAt:e.event_data.started_at,events:{},users:{},isRunning:!1,level:0,total:0,goal:0});const n=e.event_data.last_contribution.user;let l=t.users[n];l||(l=(await w([n]))[0],t.users[n]=l),z(l,t),s>t.hypeTrain.total&&(t.hypeTrain.total=s),i>t.hypeTrain.level&&!t.hypeTrain.isRunning&&(a=!0,t.hypeTrain.level=i)}}a&&(t.hypeTrain.isRunning=!0,C(t))},P=e=>{e.classList.remove("visible"),e.classList.add("invisible")},k=e=>{e.classList.add("visible"),e.classList.remove("invisible")},S={users:{},hypeTrain:{events:{},users:{},startedAt:null,isRunning:!1,level:0,total:0,goal:0},deleteCounters:{}};(async(e,t,r)=>{e.deleteCounters[170166760]=await(async e=>{const t=document.createElement("div");return t.innerHTML="0",t.classList.add("delete_counter"),t.classList.add("invisible"),document.getElementsByClassName("root")[0].appendChild(t),{deletedMessages:0,messageIds:{},shouldDisplay:!1,isFlashing:!1,element:t,nicknames:e}})(["mav","maveric","maverick"])})(S),window.addEventListener("load",i),window.addEventListener("resize",i),window.addEventListener("onEventReceived",(r=>{switch(r.detail.listener){case"message":((r,i)=>{const{userId:a,msgId:s,text:o}=r.data;Object.entries(i.deleteCounters).map((([e,t])=>{e===a&&(t.messageIds[s]=!0)})),[e,t].includes(a)&&((e,t)=>{"choo choo"!==e?Object.entries(t.deleteCounters).some((([r,i])=>{const{nicknames:a}=i,s=[...a],o=t.users[r];o&&o.display_name&&s.push(o.display_name);let n=s.length;for(;n--;){const t=s[n];if(e===`show ${t} counter`)return k(i.element),n=0,!0;if(e===`hide ${t} counter`)return P(i.element),n=0,!0;if(e===`flash ${t} counter`)return k(i.element),setTimeout((()=>P(i.element)),6e3),n=0,!0;o&&o.display_name}return!1}))||e.startsWith("makedeletecounter")||e.startsWith("newpoll"):t.hypeTrain.isRunning||(t.hypeTrain.isRunning=!0,C(t))})(o.toLowerCase().trim(),i)})(r.detail.event,S);break;case"delete-message":((e,t)=>{const{msgId:r}=e;Object.entries(t.deleteCounters).map((([e,t])=>{t.messageIds[r]&&(t.element.innerHTML=++t.deletedMessages)}))})(r.detail.event,S);break;case"subscriber-latest":case"tip-latest":case"cheer-latest":((e,t)=>{x(t)})(r.detail.event,S)}}))})();